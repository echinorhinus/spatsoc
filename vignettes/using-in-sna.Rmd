---
title: "Using spatsoc in social network analysis"
author: "Alec Robitaille, Quinn Webber and Eric Vander Wal"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    number_sections: true
    toc: false
vignette: >
  %\VignetteIndexEntry{Using spatsoc for social network analysis}
  %\VignetteEngine{knitr::knitr}
  %\VignetteEncoding{UTF-8}
---

```{r knitropts, include = FALSE}
knitr::opts_chunk$set(message = TRUE, 
                      warning = FALSE,
                      eval = FALSE, 
                      echo = FALSE)
```


spatsoc can be used in social network analysis to:

1. generate gambit of the group format data
1. perform data stream randomization

<!-- better this.. -->

# Grouping functions
Gambit of the group format data is generated by grouping relocation data temporally and spatially. 

With spatsoc, we can consider spatial grouping at 3 distinct scales...  



## Point based grouping
Pick a temporal threshold and spatial distance threshold to define grouping, depending on species and study specific <!--blah.-->

<!-- code-->


## Line based grouping
Longer temporal threshold to create, for example, daily trajectories that are optionally buffered. 

<!-- code-->


## Polygon based grouping

<!-- code-->

# Data stream randomization

## step

## daily

## trajectory


# Example
Here is an example of point based spatial grouping with `spatsoc`'s "Newfoundland Bog Cow" example data. 

The data has a relocation rate of 2 hours but we will use a temporal threshold of 5 minutes. <!-- It is important to note that the temporal window is fixed in terms of 24 hours AND EXPLAIN LIMITATIONS?--> In addition, we will use a spatial distance threshold of 50 meters to accommodate the size and behaviour of the study species. The combination of spatial and temporal thresholds means that any individuals within 50 meters of each other within 5 minutes will be assigned to the same group.

## Generate network

```{r}
# Load packages
library(spatsoc)
library(data.table)

# Read data as a data.table
DT <- fread(system.file("extdata", "DT.csv", package = "spatsoc"))

# Cast datetime column to POSIXct
DT[, datetime := as.POSIXct(datetime)]

# Year of row 
DT[, yr := year(datetime)]

# Temporal groups
group_times(DT, datetime = 'datetime', threshold = '5 minutes')

# Spatial groups
group_pts(
  DT,
  threshold = 50,
  id = 'ID',
  coords = c('X', 'Y'),
  timegroup = 'timegroup'
)
d <- dcast(DT, formula = group ~ ID, 
           fun.aggregate = length, value.var = 'group')

gbi <- as.matrix(d[, .SD, .SDcols = colnames(d)[!grepl('group', colnames(d))]])
rownames(gbi) <- d$group

library(asnipe)
net <- get_network(gbi, data_format = "GBI", association_index = "SRI")

randDT <-
  randomizations(
    DT,
    type = 'step',
    id = 'ID',
    datetime = 'timegroup',
    iterations = 500
  )

group_pts(
  randDT,
  threshold = 50,
  id = 'randomID',
  coords = c('X', 'Y'),
  timegroup = 'timegroup',
  splitBy = 'iteration'
)

```

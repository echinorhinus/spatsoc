<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Alec Robitaille" />

<meta name="date" content="2017-09-13" />

<title>Introduction to spatsoc</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Introduction to spatsoc</h1>
<h4 class="author"><em>Alec Robitaille</em></h4>
<h4 class="date"><em>2017-09-13</em></h4>



<p>The <code>spatsoc</code> package aims to provide functionality for analysing animal location data in time and space to find potential interactions or social groups.</p>
<p>The package contains a set of <code>Group*</code> functions that are used for finding groups in input data depending on spatial location and (optionally) time. In addition, the package contains functions for determining the nearest neighbor to each individual, as well as the mean pairwise distance between a set of individuals (both optionally across time).</p>
<div id="functions" class="section level2">
<h2>Functions</h2>
<ul>
<li>Grouping
<ul>
<li><code>GroupPts</code><br />
</li>
<li><code>GroupLines</code><br />
</li>
<li><code>GroupHRs</code> / <code>GroupPolys</code></li>
<li><code>GroupClusters</code></li>
<li><code>CalcCentroids</code></li>
<li><code>GroupTime</code></li>
</ul></li>
<li>Mean pairwise distance
<ul>
<li><code>PairwiseDist</code></li>
</ul></li>
<li>Nearest neighbor
<ul>
<li><code>Nearest</code></li>
</ul></li>
<li>Randomization of IDs within groups
<ul>
<li><code>Randomizations</code></li>
</ul></li>
<li>Helper functions
<ul>
<li><code>BuildPts</code></li>
<li><code>BuildLines</code></li>
<li><code>BuildHRs</code></li>
<li><code>BuildClusters</code></li>
<li><code>RoundTime</code></li>
</ul></li>
</ul>
</div>
<div id="grouping" class="section level2">
<h2>Grouping</h2>
<p>Let’s read in <code>spatsoc</code>’s example data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spatsoc); <span class="kw">library</span>(data.table)
<span class="kw">data</span>(locs)
locs[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</code></pre></div>
<pre><code>##      ID      idate    itime   X_COORD  Y_COORD  EASTING NORTHING
## 1: ind1 2010-01-16 00:00:49 -54.54954 48.17941 682152.7  5339145
## 2: ind1 2010-01-16 05:00:54 -54.55161 48.17919 681999.1  5339116
## 3: ind1 2010-01-16 10:00:50 -54.55159 48.17925 682000.9  5339122
## 4: ind1 2010-01-16 15:00:55 -54.56311 48.17490 681159.4  5338612
## 5: ind1 2010-01-16 20:00:54 -54.57921 48.15350 680037.8  5336195</code></pre>
<p>The data consists of the location of 23 individuals over 15 days. The location was recorded using GPS collars with two-hour fixes. Using this data, we can compare the various grouping methods available in <code>spatsoc</code>.</p>
<div id="grouppts" class="section level3">
<h3><code>GroupPts</code></h3>
<p>The <code>GroupPts</code> function compares the location of all individuals at each time step in the input data and groups those within a provided distance.</p>
<p>Before grouping, we will ensure that the time field we intend to group on is suitable. First, we will check how many locations are taken more than 5 minutes off of the nearest hour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">locs[<span class="kw">minute</span>(itime) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, .N]</code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">locs[<span class="kw">minute</span>(itime) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>]</code></pre></div>
<pre><code>##        ID      idate    itime   X_COORD  Y_COORD  EASTING NORTHING
##  1:  ind1 2010-01-30 05:40:43 -54.63622 48.06663 676094.8  5326409
##  2:  ind5 2010-01-29 00:40:54 -54.65353 48.03558 674910.3  5322918
##  3:  ind6 2010-01-17 00:40:50 -54.98782 47.89605 650397.7  5306706
##  4:  ind6 2010-01-19 20:40:54 -54.93632 47.95971 654058.0  5313884
##  5:  ind9 2010-01-31 15:40:54 -54.67109 48.07432 673471.7  5327184
##  6: ind10 2010-01-27 10:41:23 -55.23654 48.26501 630868.4  5347258
##  7: ind11 2010-01-18 10:40:42 -54.87401 48.01855 658528.9  5320549
##  8: ind11 2010-01-23 15:50:50 -55.27833 48.17091 628001.7  5336730
##  9: ind11 2010-01-27 15:50:55 -54.94322 48.00784 653400.0  5319218
## 10: ind12 2010-01-16 00:40:26 -54.67240 48.16536 673067.9  5337299
## 11: ind12 2010-01-22 10:40:50 -54.91741 48.28590 654488.1  5350174
## 12: ind12 2010-01-28 05:50:47 -54.63666 48.07749 676025.0  5327615
## 13: ind14 2010-01-22 20:40:53 -55.26529 48.30066 628645.6  5351173
## 14: ind14 2010-01-28 00:50:47 -55.26328 48.23642 628956.3  5344036
## 15: ind17 2010-01-25 10:40:47 -54.66341 48.06641 674070.3  5326322
## 16: ind18 2010-01-31 15:50:53 -55.04466 48.05157 645711.4  5323882
## 17: ind20 2010-01-21 05:40:49 -54.60086 48.15089 678437.1  5335855
## 18: ind21 2010-01-18 00:40:47 -55.26763 48.32441 628412.5  5353808
## 19: ind22 2010-01-24 10:40:48 -54.75892 48.02256 667097.1  5321238
## 20: ind22 2010-01-26 00:40:25 -54.76696 48.01598 666518.7  5320489</code></pre>
<p>If we want to group individuals in time and space, it is clear that these 20 locations may not be relevant to those recorded ~40-50 minutes earlier. We will round the times to the nearest hour using <code>RoundTime</code> and returning them <code>as.POSIXct</code> datetimes if a date field is provided. Alternatively, if the temporal scale of your input data is different, time fields can be rounded using different round units such as <code>'15 minutes'</code> or <code>'4 hours'</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">locs[, roundDateTime <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">RoundTime</span>(.SD, <span class="st">'itime'</span>, <span class="dt">roundUnit =</span> <span class="st">'1 hour'</span>, <span class="dt">dateField =</span> <span class="st">'idate'</span>)]</code></pre></div>
<!-- Finally, the data preparation is complete by using the grouppts to call helper function
above roundtime to group times to on nearest hour-->
<p>We can then use the <code>GroupPts</code> function to find overlapping spatial location of buffered points. Here, we buffer each point by 50m to match temporal and spatial overlap of potential interation or social group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">GroupPts</span>(locs, <span class="dv">50</span>, <span class="dt">timeField =</span> <span class="st">'roundDateTime'</span>, 
         <span class="dt">projection =</span> <span class="st">'+proj=utm +zone=21 ellps=WGS84'</span>, 
         <span class="dt">idField =</span> <span class="st">'ID'</span>, <span class="dt">coordFields =</span> <span class="kw">c</span>(<span class="st">'EASTING'</span>, <span class="st">'NORTHING'</span>))</code></pre></div>
<!-- ?QW when would best period be for social interactions -->
<!---
The basic methodology is as follows:

1. Group locations by overlapping or matching time. 
1. Group locations 
1. *Optionally* round time fields.
-->
</div>
</div>
<div id="notes" class="section level2">
<h2>Notes</h2>
<p>Package dependencies for <code>spatsoc</code> are primarily <code>sp</code>, <code>rgeos</code>, and <code>data.table</code>. <code>data.table</code> provides efficient methods for manipulating large (or small) datasets. As a result, input <code>DT</code> for all <code>spatsoc</code> functions must be a <code>data.table</code> and if it isn’t, you can simply use <code>setDT(df)</code> to convert it by reference.</p>
<p>In addition, since the <code>rgeos</code> package is used in most functions (notably <code>GroupPts</code> and <code>GroupLines</code>) the input <code>DT</code>’s coordinate system is important. <code>rgeos</code> expects planar coordinates and this requirement is carried forward for <code>spatsoc</code>.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
